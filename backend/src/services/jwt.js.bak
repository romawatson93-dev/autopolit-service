// backend/src/services/jwt.js
const jwt = require("jsonwebtoken");

const ACCESS_TTL = process.env.ACCESS_TTL || "15m";
const REFRESH_TTL = process.env.REFRESH_TTL || "30d";
const JWT_SECRET = process.env.JWT_SECRET;

function signAccess(payload) {
  return jwt.sign({ ...payload, typ: "access" }, JWT_SECRET, { expiresIn: ACCESS_TTL });
}

function signRefresh(payload) {
  return jwt.sign({ ...payload, typ: "refresh" }, JWT_SECRET, { expiresIn: REFRESH_TTL });
}

function verifyToken(token) {
  try {
    return { ok: true, data: jwt.verify(token, JWT_SECRET) };
  } catch (e) {
    return { ok: false, error: e.name || "JWT_ERROR" };
  }
}

module.exports = { signAccess, signRefresh, verifyToken, ACCESS_TTL, REFRESH_TTL };
