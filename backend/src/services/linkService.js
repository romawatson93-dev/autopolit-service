-/-/- -b-a-c-k-e-n-d-/-s-r-c-/-s-e-r-v-i-c-e-s-/-l-i-n-k-S-e-r-v-i-c-e-.-j-s-
-
-/-/- -ы-т-а-е-м-с-я- -п-о-д-т-я-н-у-т-ь- -s-e-q-u-e-l-i-z-e---м-о-д-е-л-и-;- -е-с-л-и- -и-х- -н-е-т-/-о-н-и- -о-т-л-и-ч-а-ю-т-с-я- -—- -н-е- -п-а-д-а-е-м-
-l-e-t- -m-o-d-e-l-s- -=- -n-u-l-l-;-
-t-r-y- -{- -m-o-d-e-l-s- -=- -r-e-q-u-i-r-e-(-"-.-.-/-m-o-d-e-l-s-"-)-;- -}- -c-a-t-c-h- -(-_-)- -{- -m-o-d-e-l-s- -=- -n-u-l-l-;- -}-
-
-f-u-n-c-t-i-o-n- -i-p-F-r-o-m-R-e-q-(-r-e-q-)- -{-
- - -r-e-t-u-r-n- -(-r-e-q-.-h-e-a-d-e-r-s-[-"-x---f-o-r-w-a-r-d-e-d---f-o-r-"-]- -|-|- -r-e-q-.-s-o-c-k-e-t-?-.-r-e-m-o-t-e-A-d-d-r-e-s-s- -|-|- -"-"-)-
- - - - -.-t-o-S-t-r-i-n-g-(-)-.-s-p-l-i-t-(-"-,-"-)-[-0-]-.-t-r-i-m-(-)-;-
-}-
-
-f-u-n-c-t-i-o-n- -u-a-F-r-o-m-R-e-q-(-r-e-q-)- -{-
- - -r-e-t-u-r-n- -(-r-e-q-.-h-e-a-d-e-r-s-[-"-u-s-e-r---a-g-e-n-t-"-]- -|-|- -"-"-)-.-t-o-S-t-r-i-n-g-(-)-;-
-}-
-
-/-*-*-
- -*- -а-х-о-д-и-т- -с-с-ы-л-к-у- -п-о- -т-о-к-е-н-у-.- -о-д-д-е-р-ж-и-в-а-е-т- -р-а-з-н-ы-е- -с-х-е-м-ы-:-
- -*- --- -m-o-d-e-l-s-.-L-i-n-k- -с- -п-о-л-я-м-и- -t-o-k-e-n-/-s-l-u-g- -и- -e-x-p-i-r-e-s-A-t-/-m-a-x-O-p-e-n-s-/-o-p-e-n-s-C-o-u-n-t-/-u-r-l-/-t-i-t-l-e-
- -*- -о-з-в-р-а-щ-а-е-т- -{- -o-k-,- -l-i-n-k-|-n-u-l-l-,- -r-e-a-s-o-n-?- -}-
- -*-/-
-a-s-y-n-c- -f-u-n-c-t-i-o-n- -f-i-n-d-L-i-n-k-B-y-T-o-k-e-n-(-t-o-k-e-n-)- -{-
- - -i-f- -(-!-m-o-d-e-l-s-?-.-L-i-n-k-)- -r-e-t-u-r-n- -{- -o-k-:- -f-a-l-s-e-,- -r-e-a-s-o-n-:- -"-N-O-_-M-O-D-E-L-"- -}-;-
- - -c-o-n-s-t- -{- -L-i-n-k- -}- -=- -m-o-d-e-l-s-;-
-
- - -/-/- -ы-т-а-е-м-с-я- -у-г-а-д-а-т-ь- -п-о-л-е- -т-о-к-е-н-а-
- - -c-o-n-s-t- -w-h-e-r-e-V-a-r-i-a-n-t-s- -=- -[-
- - - - -{- -t-o-k-e-n- -}-,-
- - - - -{- -s-l-u-g-:- -t-o-k-e-n- -}-,-
- - - - -{- -a-c-c-e-s-s-T-o-k-e-n-:- -t-o-k-e-n- -}-,-
- - -]-;-
-
- - -f-o-r- -(-c-o-n-s-t- -w-h-e-r-e- -o-f- -w-h-e-r-e-V-a-r-i-a-n-t-s-)- -{-
- - - - -t-r-y- -{-
- - - - - - -c-o-n-s-t- -l-i-n-k- -=- -a-w-a-i-t- -L-i-n-k-.-f-i-n-d-O-n-e-(-{- -w-h-e-r-e- -}-)-;-
- - - - - - -i-f- -(-l-i-n-k-)- -r-e-t-u-r-n- -{- -o-k-:- -t-r-u-e-,- -l-i-n-k- -}-;-
- - - - -}- -c-a-t-c-h- -(-e-)- -{- -/-*- -п-р-о-б-у-е-м- -д-а-л-ь-ш-е- -*-/- -}-
- - -}-
-
- - -r-e-t-u-r-n- -{- -o-k-:- -f-a-l-s-e-,- -r-e-a-s-o-n-:- -"-N-O-T-_-F-O-U-N-D-"- -}-;-
-}-
-
-/-*-*-
- -*- -ы-п-о-л-н-я-е-т- -п-р-о-в-е-р-к-и- -д-о-с-т-у-п-а-:- -с-р-о-к-,- -л-и-м-и-т- -о-т-к-р-ы-т-и-й-.-
- -*- -о-д-д-е-р-ж-и-в-а-е-т- -р-а-з-н-ы-е- -и-м-е-н-а- -п-о-л-е-й-.-
- -*- -о-з-в-р-а-щ-а-е-т- -{- -o-k-,- -r-e-a-s-o-n-?- -}-
- -*-/-
-f-u-n-c-t-i-o-n- -c-h-e-c-k-A-c-c-e-s-s-(-l-i-n-k-I-n-s-t-a-n-c-e-)- -{-
- - -t-r-y- -{-
- - - - -c-o-n-s-t- -l-i-n-k- -=- -l-i-n-k-I-n-s-t-a-n-c-e-?-.-g-e-t- -?- -l-i-n-k-I-n-s-t-a-n-c-e-.-g-e-t-(-)- -:- -l-i-n-k-I-n-s-t-a-n-c-e-;-
-
- - - - -/-/- -1-)- -С-р-о-к- -г-о-д-н-о-с-т-и-
- - - - -c-o-n-s-t- -e-x-p-i-r-e-s-A-t- -=- -l-i-n-k-.-e-x-p-i-r-e-s-A-t- -|-|- -l-i-n-k-.-e-x-p-i-r-e-A-t- -|-|- -l-i-n-k-.-e-x-p-i-r-e-s- -|-|- -n-u-l-l-;-
- - - - -i-f- -(-e-x-p-i-r-e-s-A-t-)- -{-
- - - - - - -c-o-n-s-t- -e-x-p- -=- -n-e-w- -D-a-t-e-(-e-x-p-i-r-e-s-A-t-)-.-g-e-t-T-i-m-e-(-)-;-
- - - - - - -i-f- -(-!-N-u-m-b-e-r-.-i-s-N-a-N-(-e-x-p-)- -&-&- -D-a-t-e-.-n-o-w-(-)- ->- -e-x-p-)- -{-
- - - - - - - - -r-e-t-u-r-n- -{- -o-k-:- -f-a-l-s-e-,- -r-e-a-s-o-n-:- -"-E-X-P-I-R-E-D-"- -}-;-
- - - - - - -}-
- - - - -}-
-
- - - - -/-/- -2-)- -и-м-и-т- -о-т-к-р-ы-т-и-й-
- - - - -c-o-n-s-t- -m-a-x-O-p-e-n-s- -=- -l-i-n-k-.-m-a-x-O-p-e-n-s- -?-?- -l-i-n-k-.-o-p-e-n-L-i-m-i-t- -?-?- -n-u-l-l-;-
- - - - -c-o-n-s-t- -o-p-e-n-s-C-o-u-n-t- -=- -l-i-n-k-.-o-p-e-n-s-C-o-u-n-t- -?-?- -l-i-n-k-.-o-p-e-n-C-o-u-n-t- -?-?- -0-;-
-
- - - - -i-f- -(-m-a-x-O-p-e-n-s- -!-=- -n-u-l-l- -&-&- -N-u-m-b-e-r-.-i-s-F-i-n-i-t-e-(-N-u-m-b-e-r-(-m-a-x-O-p-e-n-s-)-)-)- -{-
- - - - - - -i-f- -(-N-u-m-b-e-r-(-o-p-e-n-s-C-o-u-n-t-)- ->-=- -N-u-m-b-e-r-(-m-a-x-O-p-e-n-s-)-)- -{-
- - - - - - - - -r-e-t-u-r-n- -{- -o-k-:- -f-a-l-s-e-,- -r-e-a-s-o-n-:- -"-O-P-E-N-_-L-I-M-I-T-_-R-E-A-C-H-E-D-"- -}-;-
- - - - - - -}-
- - - - -}-
-
- - - - -r-e-t-u-r-n- -{- -o-k-:- -t-r-u-e- -}-;-
- - -}- -c-a-t-c-h- -(-e-)- -{-
- - - - -r-e-t-u-r-n- -{- -o-k-:- -f-a-l-s-e-,- -r-e-a-s-o-n-:- -"-C-H-E-C-K-_-E-R-R-O-R-"- -}-;-
- - -}-
-}-
-
-/-*-*-
- -*- -н-к-р-е-м-е-н-т-и-р-у-е-т- -с-ч-ё-т-ч-и-к- -о-т-к-р-ы-т-и-й-,- -е-с-л-и- -п-о-л-е- -с-у-щ-е-с-т-в-у-е-т-.-
- -*- -е-л-а-е-т- -b-e-s-t-‑-e-f-f-o-r-t-:- -в- -п-р-о-т-и-в-н-о-м- -с-л-у-ч-а-е- -м-о-л-ч-а- -п-р-о-п-у-с-к-а-е-т-.-
- -*-/-
-a-s-y-n-c- -f-u-n-c-t-i-o-n- -b-u-m-p-O-p-e-n-C-o-u-n-t-e-r-(-l-i-n-k-I-n-s-t-a-n-c-e-)- -{-
- - -i-f- -(-!-l-i-n-k-I-n-s-t-a-n-c-e-)- -r-e-t-u-r-n-;-
- - -t-r-y- -{-
- - - - -c-o-n-s-t- -h-a-s-O-p-e-n-s-C-o-u-n-t- -=- -O-b-j-e-c-t-.-p-r-o-t-o-t-y-p-e-.-h-a-s-O-w-n-P-r-o-p-e-r-t-y-.-c-a-l-l-(-l-i-n-k-I-n-s-t-a-n-c-e-,- -"-o-p-e-n-s-C-o-u-n-t-"-)-;-
- - - - -i-f- -(-h-a-s-O-p-e-n-s-C-o-u-n-t-)- -{-
- - - - - - -l-i-n-k-I-n-s-t-a-n-c-e-.-o-p-e-n-s-C-o-u-n-t- -=- -N-u-m-b-e-r-(-l-i-n-k-I-n-s-t-a-n-c-e-.-o-p-e-n-s-C-o-u-n-t- -|-|- -0-)- -+- -1-;-
- - - - - - -a-w-a-i-t- -l-i-n-k-I-n-s-t-a-n-c-e-.-s-a-v-e-(-)-;-
- - - - - - -r-e-t-u-r-n-;-
- - - - -}-
- - - - -/-/- -н-ы-е- -в-а-р-и-а-н-т-ы- -и-м-ё-н-
- - - - -f-o-r- -(-c-o-n-s-t- -f-i-e-l-d- -o-f- -[-"-o-p-e-n-C-o-u-n-t-"-,- -"-v-i-e-w-s-"-,- -"-o-p-e-n-s-"-]-)- -{-
- - - - - - -i-f- -(-O-b-j-e-c-t-.-p-r-o-t-o-t-y-p-e-.-h-a-s-O-w-n-P-r-o-p-e-r-t-y-.-c-a-l-l-(-l-i-n-k-I-n-s-t-a-n-c-e-,- -f-i-e-l-d-)-)- -{-
- - - - - - - - -l-i-n-k-I-n-s-t-a-n-c-e-[-f-i-e-l-d-]- -=- -N-u-m-b-e-r-(-l-i-n-k-I-n-s-t-a-n-c-e-[-f-i-e-l-d-]- -|-|- -0-)- -+- -1-;-
- - - - - - - - -a-w-a-i-t- -l-i-n-k-I-n-s-t-a-n-c-e-.-s-a-v-e-(-)-;-
- - - - - - - - -r-e-t-u-r-n-;-
- - - - - - -}-
- - - - -}-
- - -}- -c-a-t-c-h- -(-_-)- -{-/-*- -n-o---o-p- -*-/-}-
-}-
-
-/-*-*-
- -*- -и-ш-е-т- -с-о-б-ы-т-и-е- -о-т-к-р-ы-т-и-я- -(-е-с-л-и- -е-с-т-ь- -м-о-д-е-л-и- -A-c-c-e-s-s-L-o-g- -и-л-и- -O-p-e-n-E-v-e-n-t-)-.-
- -*-/-
-a-s-y-n-c- -f-u-n-c-t-i-o-n- -w-r-i-t-e-O-p-e-n-E-v-e-n-t-(-{- -r-e-q-,- -l-i-n-k-,- -s-t-a-t-u-s- -=- -"-O-K-"-,- -e-r-r-o-r- -=- -n-u-l-l- -}-)- -{-
- - -i-f- -(-!-m-o-d-e-l-s-)- -r-e-t-u-r-n-;-
- - -c-o-n-s-t- -i-p- -=- -i-p-F-r-o-m-R-e-q-(-r-e-q-)-;-
- - -c-o-n-s-t- -u-a- -=- -u-a-F-r-o-m-R-e-q-(-r-e-q-)-;-
-
- - -c-o-n-s-t- -t-r-y-C-r-e-a-t-e- -=- -a-s-y-n-c- -(-M-o-d-e-l-N-a-m-e-,- -d-a-t-a-)- -=->- -{-
- - - - -c-o-n-s-t- -M- -=- -m-o-d-e-l-s-[-M-o-d-e-l-N-a-m-e-]-;-
- - - - -i-f- -(-!-M-)- -r-e-t-u-r-n- -f-a-l-s-e-;-
- - - - -t-r-y- -{- -a-w-a-i-t- -M-.-c-r-e-a-t-e-(-d-a-t-a-)-;- -r-e-t-u-r-n- -t-r-u-e-;- -}- -c-a-t-c-h- -(-_-)- -{- -r-e-t-u-r-n- -f-a-l-s-e-;- -}-
- - -}-;-
-
- - -/-/- -ы-т-а-е-м-с-я- -н-а-п-и-с-а-т-ь- -в- -A-c-c-e-s-s-L-o-g-
- - -c-o-n-s-t- -o-k-1- -=- -a-w-a-i-t- -t-r-y-C-r-e-a-t-e-(-"-A-c-c-e-s-s-L-o-g-"-,- -{-
- - - - -l-i-n-k-I-d-:- -l-i-n-k-?-.-i-d-,-
- - - - -t-o-k-e-n-:- -l-i-n-k-?-.-t-o-k-e-n- -|-|- -n-u-l-l-,-
- - - - -i-p-,-
- - - - -u-s-e-r-A-g-e-n-t-:- -u-a-,-
- - - - -s-t-a-t-u-s-,-
- - - - -e-r-r-o-r-,-
- - -}-)-;-
-
- - -/-/- -с-л-и- -н-е-т- -A-c-c-e-s-s-L-o-g- -—- -п-р-о-б-у-е-м- -O-p-e-n-E-v-e-n-t-
- - -i-f- -(-!-o-k-1-)- -{-
- - - - -a-w-a-i-t- -t-r-y-C-r-e-a-t-e-(-"-O-p-e-n-E-v-e-n-t-"-,- -{-
- - - - - - -l-i-n-k-I-d-:- -l-i-n-k-?-.-i-d-,-
- - - - - - -t-o-k-e-n-:- -l-i-n-k-?-.-t-o-k-e-n- -|-|- -n-u-l-l-,-
- - - - - - -i-p-,-
- - - - - - -u-s-e-r-A-g-e-n-t-:- -u-a-,-
- - - - - - -r-e-s-u-l-t-:- -s-t-a-t-u-s-,-
- - - - - - -e-r-r-o-r-,-
- - - - -}-)-;-
- - -}-
-}-
-
-m-o-d-u-l-e-.-e-x-p-o-r-t-s- -=- -{-
- - -f-i-n-d-L-i-n-k-B-y-T-o-k-e-n-,-
- - -c-h-e-c-k-A-c-c-e-s-s-,-
- - -b-u-m-p-O-p-e-n-C-o-u-n-t-e-r-,-
- - -w-r-i-t-e-O-p-e-n-E-v-e-n-t-,-
-}-;--
-
