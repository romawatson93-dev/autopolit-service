-/-/- -b-a-c-k-e-n-d-/-s-r-c-/-s-e-r-v-i-c-e-s-/-s-e-s-s-i-o-n-S-e-r-v-i-c-e-.-j-s-
-c-o-n-s-t- -{- -s-i-g-n-A-c-c-e-s-s-,- -s-i-g-n-R-e-f-r-e-s-h-,- -v-e-r-i-f-y-T-o-k-e-n- -}- -=- -r-e-q-u-i-r-e-(-"-.-/-j-w-t-"-)-;-
-
-/-/- -о-п-р-о-б-у-е-м- -п-о-д-т-я-н-у-т-ь- -м-о-д-е-л-и- -(-е-с-л-и- -е-с-т-ь-)-
-l-e-t- -m-o-d-e-l-s- -=- -n-u-l-l-;-
-t-r-y- -{-
- - -m-o-d-e-l-s- -=- -r-e-q-u-i-r-e-(-"-.-.-/-m-o-d-e-l-s-"-)-;- -/-/- -о-ж-и-д-а-е-т-с-я- -m-o-d-e-l-s-.-C-l-i-e-n-t-S-e-s-s-i-o-n- -/- -m-o-d-e-l-s-.-C-l-i-e-n-t-D-e-v-i-c-e-
-}- -c-a-t-c-h- -(-_-)- -{-
- - -m-o-d-e-l-s- -=- -n-u-l-l-;-
-}-
-
-f-u-n-c-t-i-o-n- -i-p-F-r-o-m-R-e-q-(-r-e-q-)- -{-
- - -r-e-t-u-r-n- -(-r-e-q-.-h-e-a-d-e-r-s-[-"-x---f-o-r-w-a-r-d-e-d---f-o-r-"-]- -|-|- -r-e-q-.-s-o-c-k-e-t-?-.-r-e-m-o-t-e-A-d-d-r-e-s-s- -|-|- -"-"-)-.-t-o-S-t-r-i-n-g-(-)-.-s-p-l-i-t-(-"-,-"-)-[-0-]-.-t-r-i-m-(-)-;-
-}-
-
-f-u-n-c-t-i-o-n- -u-a-F-r-o-m-R-e-q-(-r-e-q-)- -{-
- - -r-e-t-u-r-n- -(-r-e-q-.-h-e-a-d-e-r-s-[-"-u-s-e-r---a-g-e-n-t-"-]- -|-|- -"-"-)-.-t-o-S-t-r-i-n-g-(-)-;-
-}-
-
-/-*-*-
- -*- -С-о-з-д-а-ё-т-/-о-б-н-о-в-л-я-е-т- -к-л-и-е-н-т-с-к-у-ю- -с-е-с-с-и-ю-.-
- -*- -о-з-в-р-а-щ-а-е-т- -r-e-f-r-e-s-h-/-a-c-c-e-s-s- -т-о-к-е-н-ы-.- -и-ш-е-т- -в- - -п-р-и- -н-а-л-и-ч-и-и- -с-о-в-м-е-с-т-и-м-ы-х- -м-о-д-е-л-е-й-.-
- -*-/-
-a-s-y-n-c- -f-u-n-c-t-i-o-n- -s-t-a-r-t-S-e-s-s-i-o-n-(-{- -r-e-q-,- -c-l-i-e-n-t- -}-)- -{-
- - -c-o-n-s-t- -i-p- -=- -i-p-F-r-o-m-R-e-q-(-r-e-q-)-;-
- - -c-o-n-s-t- -u-a- -=- -u-a-F-r-o-m-R-e-q-(-r-e-q-)-;-
-
- - -/-/- -а-з-о-в-а-я- -п-о-л-е-з-н-а-я- -н-а-г-р-у-з-к-а- -д-л-я- -т-о-к-е-н-о-в-
- - -c-o-n-s-t- -b-a-s-e- -=- -{-
- - - - -s-u-b-:- -c-l-i-e-n-t-?-.-s-u-b- -|-|- -n-u-l-l-,-
- - - - -t-g-:- -c-l-i-e-n-t-?-.-t-g- -|-|- -n-u-l-l-,-
- - - - -l-i-n-k-T-o-k-e-n-:- -c-l-i-e-n-t-?-.-l-i-n-k-T-o-k-e-n- -|-|- -n-u-l-l-,-
- - -}-;-
-
- - -/-/- -е-н-е-р-а-ц-и-я- -т-о-к-е-н-о-в-
- - -c-o-n-s-t- -r-e-f-r-e-s-h-T-o-k-e-n- -=- -s-i-g-n-R-e-f-r-e-s-h-(-b-a-s-e-)-;-
- - -c-o-n-s-t- -a-c-c-e-s-s-T-o-k-e-n- -=- -s-i-g-n-A-c-c-e-s-s-(-b-a-s-e-)-;-
-
- - -/-/- -и-ш-е-м- -в- - -(-b-e-s-t---e-f-f-o-r-t-)-
- - -i-f- -(-m-o-d-e-l-s-?-.-C-l-i-e-n-t-S-e-s-s-i-o-n-)- -{-
- - - - -t-r-y- -{-
- - - - - - -/-/- -у-н-и-в-е-р-с-а-л-ь-н-ы-й- -u-p-s-e-r-t- -п-о- -r-e-f-r-e-s-h-T-o-k-e-n- -(-и-л-и- -п-о- -s-u-b-+-u-a-)-
- - - - - - -c-o-n-s-t- -w-h-e-r-e- -=- -{- -r-e-f-r-e-s-h-T-o-k-e-n- -}-;-
- - - - - - -c-o-n-s-t- -d-e-f-a-u-l-t-s- -=- -{-
- - - - - - - - -r-e-f-r-e-s-h-T-o-k-e-n-,-
- - - - - - - - -i-p-,-
- - - - - - - - -u-s-e-r-A-g-e-n-t-:- -u-a-,-
- - - - - - - - -s-u-b-j-e-c-t-:- -b-a-s-e-.-s-u-b-,-
- - - - - - - - -l-i-n-k-T-o-k-e-n-:- -b-a-s-e-.-l-i-n-k-T-o-k-e-n-,-
- - - - - - -}-;-
- - - - - - -/-/- - -р-а-з-н-ы-х- -с-х-е-м-а-х- -м-о-ж-е-т- -н-е- -б-ы-т-ь- -u-p-s-e-r-t- -→- -f-a-l-l-b-a-c-k-:- -c-r-e-a-t-e-
- - - - - - -i-f- -(-t-y-p-e-o-f- -m-o-d-e-l-s-.-C-l-i-e-n-t-S-e-s-s-i-o-n-.-u-p-s-e-r-t- -=-=-=- -"-f-u-n-c-t-i-o-n-"-)- -{-
- - - - - - - - -a-w-a-i-t- -m-o-d-e-l-s-.-C-l-i-e-n-t-S-e-s-s-i-o-n-.-u-p-s-e-r-t-(-{- -.-.-.-d-e-f-a-u-l-t-s-,- -.-.-.-w-h-e-r-e- -}-)-;-
- - - - - - -}- -e-l-s-e- -{-
- - - - - - - - -a-w-a-i-t- -m-o-d-e-l-s-.-C-l-i-e-n-t-S-e-s-s-i-o-n-.-c-r-e-a-t-e-(-{- -.-.-.-d-e-f-a-u-l-t-s- -}-)-;-
- - - - - - -}-
- - - - -}- -c-a-t-c-h- -(-e-)- -{-
- - - - - - -c-o-n-s-o-l-e-.-w-a-r-n-(-"-[-s-e-s-s-i-o-n-S-e-r-v-i-c-e-]- -D-B- -w-r-i-t-e- -s-k-i-p-p-e-d-:-"-,- -e-.-m-e-s-s-a-g-e-)-;-
- - - - -}-
- - -}-
-
- - -r-e-t-u-r-n- -{- -r-e-f-r-e-s-h-T-o-k-e-n-,- -a-c-c-e-s-s-T-o-k-e-n- -}-;-
-}-
-
-/-*-*-
- -*- -б-н-о-в-л-я-е-т- -a-c-c-e-s-s- -п-о- -r-e-f-r-e-s-h-.-
- -*-/-
-a-s-y-n-c- -f-u-n-c-t-i-o-n- -r-e-f-r-e-s-h-A-c-c-e-s-s-(-{- -r-e-f-r-e-s-h-T-o-k-e-n- -}-)- -{-
- - -c-o-n-s-t- -v- -=- -v-e-r-i-f-y-T-o-k-e-n-(-r-e-f-r-e-s-h-T-o-k-e-n-)-;-
- - -i-f- -(-!-v-.-o-k-)- -r-e-t-u-r-n- -{- -o-k-:- -f-a-l-s-e-,- -e-r-r-o-r-:- -"-I-N-V-A-L-I-D-_-R-E-F-R-E-S-H-"- -}-;-
- - -i-f- -(-v-.-d-a-t-a-.-t-y-p- -!-=-=- -"-r-e-f-r-e-s-h-"-)- -r-e-t-u-r-n- -{- -o-k-:- -f-a-l-s-e-,- -e-r-r-o-r-:- -"-N-O-T-_-R-E-F-R-E-S-H-_-T-O-K-E-N-"- -}-;-
-
- - -c-o-n-s-t- -b-a-s-e- -=- -{-
- - - - -s-u-b-:- -v-.-d-a-t-a-.-s-u-b- -|-|- -n-u-l-l-,-
- - - - -t-g-:- -v-.-d-a-t-a-.-t-g- -|-|- -n-u-l-l-,-
- - - - -l-i-n-k-T-o-k-e-n-:- -v-.-d-a-t-a-.-l-i-n-k-T-o-k-e-n- -|-|- -n-u-l-l-,-
- - -}-;-
-
- - -/-/- -р-и- -ж-е-л-а-н-и-и- -м-о-ж-н-о- -п-р-о-в-е-р-я-т-ь- -r-e-f-r-e-s-h- -в- -.- -е-л-а-е-м- -b-e-s-t---e-f-f-o-r-t-:-
- - -i-f- -(-m-o-d-e-l-s-?-.-C-l-i-e-n-t-S-e-s-s-i-o-n-)- -{-
- - - - -t-r-y- -{-
- - - - - - -c-o-n-s-t- -f-o-u-n-d- -=- -a-w-a-i-t- -m-o-d-e-l-s-.-C-l-i-e-n-t-S-e-s-s-i-o-n-.-f-i-n-d-O-n-e-(-{- -w-h-e-r-e-:- -{- -r-e-f-r-e-s-h-T-o-k-e-n- -}- -}-)-;-
- - - - - - -i-f- -(-!-f-o-u-n-d-)- -{-
- - - - - - - - -r-e-t-u-r-n- -{- -o-k-:- -f-a-l-s-e-,- -e-r-r-o-r-:- -"-R-E-F-R-E-S-H-_-U-N-K-N-O-W-N-"- -}-;-
- - - - - - -}-
- - - - -}- -c-a-t-c-h- -(-e-)- -{-
- - - - - - -c-o-n-s-o-l-e-.-w-a-r-n-(-"-[-s-e-s-s-i-o-n-S-e-r-v-i-c-e-]- -D-B- -r-e-a-d- -s-k-i-p-p-e-d-:-"-,- -e-.-m-e-s-s-a-g-e-)-;-
- - - - -}-
- - -}-
-
- - -c-o-n-s-t- -a-c-c-e-s-s-T-o-k-e-n- -=- -s-i-g-n-A-c-c-e-s-s-(-b-a-s-e-)-;-
- - -r-e-t-u-r-n- -{- -o-k-:- -t-r-u-e-,- -a-c-c-e-s-s-T-o-k-e-n- -}-;-
-}-
-
-m-o-d-u-l-e-.-e-x-p-o-r-t-s- -=- -{- -s-t-a-r-t-S-e-s-s-i-o-n-,- -r-e-f-r-e-s-h-A-c-c-e-s-s- -}-;--
-
